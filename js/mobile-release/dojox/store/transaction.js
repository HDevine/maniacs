//>>built
define("dojox/store/transaction",["dojo/store/Memory","dojo/store/Cache","dojo/when","dojo/aspect","dojo/_base/lang"],function(t,u,l,v,w){var q,r={},x=1;return function(a){function m(c){return function y(e,g){var d=this;if(k){var f=b[c](e,g);l(f,null,function(c){d.errorHandler(c)&&(k=!1,g.error=c,y.call(d,e,g),k=!0)});return f}var a="remove"===c?e:d.getIdentity(e);void 0!==a&&(f=h.get(a));return l(f,function(d){return l(n.add({objectId:a,method:c,target:e,previous:d,options:g,storeId:p}),function(){return e})})}}
a=a||{};var b=a.masterStore,h=a.cachingStore,p=b.id||b.storeName||b.name||(b.id=x++);p&&(r[p]=b);var n=a.transactionLogStore||q||(q=new t),k=!0;v.before(b,"notify",function(c,a){c?h.put(c):h.remove(a)});return new u(w.delegate(b,{put:m("put"),add:m("add"),remove:m("remove"),errorHandler:function(c){return!0},commit:function(){k=!0;var c=this;return n.query({}).map(function(a){var b=a.method,e=r[a.storeId],g=a.target,d;try{d=e[b](g,a.options)}catch(f){d=c.errorHandler(f);if(!0===d)return f;!1===d&&
("add"===b?h.remove(a.objectId):h.put(g),e.notify&&e.notify("add"===b?null:a.previous,"remove"===b?void 0:a.objectId));d=f}n.remove(a.id);return d})},transaction:function(){k=!1;var a=this;return{commit:function(){return a.commit()}}}}),h,a)}});
//# sourceMappingURL=transaction.js.map